<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Signalyx</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="module">
      // Firebase import
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDrbEbEolB-hMyj4teEc_er7KGeQZCkFhA",
        authDomain: "signalyx-web.firebaseapp.com",
        projectId: "signalyx-web",
        storageBucket: "signalyx-web.firebasestorage.app",
        messagingSenderId: "276327742476",
        appId: "1:276327742476:web:5fde294924542ddae10229",
        measurementId: "G-9C6GY4132W"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      window.onload = () => {
        const form = document.getElementById("loginForm");
        const logoutBtn = document.getElementById("logout");
        const userStatus = document.getElementById("userStatus");

        onAuthStateChanged(auth, (user) => {
          if (user) {
            userStatus.innerHTML = `✅ Benvenuto, ${user.email} <br><button id="logout">Logout</button>`;
            document.getElementById("loginForm").style.display = "none";
            document.getElementById("dashboard").style.display = "block";

            document.getElementById("logout").onclick = () => {
              signOut(auth);
              location.reload();
            };
          } else {
            document.getElementById("loginForm").style.display = "block";
            document.getElementById("dashboard").style.display = "none";
          }
        });

        form.onsubmit = (e) => {
          e.preventDefault();
          const email = form.email.value;
          const password = form.password.value;
          const mode = form.mode.value;

          if (mode === "login") {
            signInWithEmailAndPassword(auth, email, password)
              .catch((err) => alert("Errore login: " + err.message));
          } else {
            createUserWithEmailAndPassword(auth, email, password)
              .catch((err) => alert("Errore registrazione: " + err.message));
          }
        };
      };
    </script>

    <style>
      body {
        background-color: #000;
        color: #fff;
        font-family: sans-serif;
        text-align: center;
        padding: 30px;
      }

      input, select, button {
        margin: 8px;
        padding: 10px;
        font-size: 16px;
        border-radius: 6px;
        border: none;
      }

      button {
        background-color: #00cc66;
        color: white;
        cursor: pointer;
      }

      button:hover {
        background-color: #00a357;
      }

      #dashboard {
        display: none;
      }
    </style>
  </head>

  <body>
    <h1>Signalyx</h1>
    <p id="userStatus"></p>

    <form id="loginForm">
      <input type="email" name="email" placeholder="Email" required /><br />
      <input type="password" name="password" placeholder="Password" required /><br />
      <select name="mode">
        <option value="login">Login</option>
        <option value="register">Registrati</option>
      </select><br />
      <button type="submit">Continua</button>
    </form>

    <div id="dashboard">
      <h2>✅ Accesso effettuato</h2>
      <p>Benvenuto nella dashboard!</p>
    </div>
  </body>
</html>
